ğŸ’¡ Tá»•ng quan kiáº¿n trÃºc multi-tenant theo schema (SCHEMA-based isolation)
Trong cáº¥u trÃºc báº¡n Ä‘ang dÃ¹ng:

1 schema trung tÃ¢m: central_db â€“ chá»©a user, metadata, mapping tenant ID

N schema tenant: restaurant_001, restaurant_002, ..., restaurant_9999

â†’ á»¨ng dá»¥ng cáº§n biáº¿t schema nÃ o tÆ°Æ¡ng á»©ng vá»›i tenant nÃ o, vÃ  switch schema khi xá»­ lÃ½ DB.

ğŸ§  CÃ¡ch há»‡ thá»‘ng chuyá»ƒn schema Ä‘á»™ng:
CÃ³ class SchemaMultiTenantConnectionProvider vá»›i Ä‘oáº¡n:

@Override
public Connection getConnection(Object tenantIdentifier) throws SQLException {
    final Connection connection = dataSource.getConnection(); // dÃ¹ng tá»« pool Ä‘Ã£ táº¡o
    connection.setSchema((String) tenantIdentifier);          // â† âš ï¸ Ä‘á»•i schema táº¡i Ä‘Ã¢y
    return connection;
}

ğŸ§© NÃªn hiá»ƒu:
dataSource.getConnection() â†’ má»Ÿ 1 connection Ä‘ang trá» vá» public (hoáº·c central_db)

connection.setSchema("restaurant_001") â†’ Ä‘á»•i schema cá»§a connection nÃ y trÆ°á»›c khi dÃ¹ng

Hibernate sáº½ dÃ¹ng connection Ä‘Ã£ Ä‘Æ°á»£c gáº¯n schema tenant Ä‘Ãºng

ğŸ” Flow Ä‘áº§y Ä‘á»§ khi gá»i API:
BÆ°á»›c	MÃ´ táº£
1.	Client gá»i API, gáº¯n X-Tenant-ID: 001
2.	TenantFilter Ä‘á»c header â†’ lÆ°u vÃ o TenantContext
3.	Hibernate gá»i SchemaCurrentTenantIdentifierResolver â†’ tráº£ vá» "restaurant_001"
4.	Hibernate gá»i SchemaMultiTenantConnectionProvider.getConnection("restaurant_001")
5.	Láº¥y connection tá»« Hikari pool (Ä‘ang default schema)
6.	Gá»i setSchema("restaurant_001") â†’ chuyá»ƒn schema Ä‘Ãºng
7.	Connection tráº£ vá» Hibernate Ä‘á»ƒ dÃ¹ng
8.	Sau khi dÃ¹ng xong, Hibernate gá»i releaseConnection(...) â†’ Ä‘Ã³ng / reuse

âœ… KHÃ”NG cáº§n táº¡o pool cho tá»«ng schema
DÃ¹ng 1 pool duy nháº¥t káº¿t ná»‘i tá»›i central_db hoáº·c public
Switch schema á»Ÿ bÆ°á»›c setSchema(...) lÃ  Ä‘á»§ (giá»‘ng Ä‘á»•i database á»Ÿ level session)
TÄƒng performance, giáº£m memory/cost, scale tá»‘t hÆ¡n nhiá»u

